<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Chat - Liga Online</title>

<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  margin:0;
  display:flex;
  flex-direction:column;
  height:100vh;
}

header{
  background:#000;
  padding:15px;
  text-align:center;
  border-bottom:2px solid #00f2ff;
}

#chatBox{
  flex:1;
  overflow-y:auto;
  padding:15px;
}

.mensagem{
  margin:8px 0;
  padding:10px;
  border-radius:8px;
  max-width:70%;
}

.minha{
  background:#00f2ff;
  color:black;
  align-self:flex-end;
}

.outro{
  background:#1c1c1c;
}

#inputArea{
  display:flex;
  padding:10px;
  background:#111;
}

#mensagem{
  flex:1;
  padding:10px;
  border-radius:6px;
  border:none;
}

button{
  padding:10px 15px;
  margin-left:5px;
  border:none;
  border-radius:6px;
  background:#00f2ff;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  ðŸ’¬ Chat Liga Online
</header>

<div id="chatBox"></div>

<div id="inputArea">
  <input type="text" id="mensagem" placeholder="Digite sua mensagem...">
  <button onclick="enviar()">Enviar</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  collection,
  addDoc,
  onSnapshot,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgLb8XfVgjmOdyMWxdWKVOygMivU6TRM0",
  authDomain: "liga-online-8f74d.firebaseapp.com",
  projectId:"liga-online-8f74d",
  appId: "1:815073531863:web:625fe25cfe74e705001d92",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let usuarioAtual = null;

onAuthStateChanged(auth, user => {
  if(!user){
    window.location.href="loginPlayer.html";
    return;
  }
  usuarioAtual = user;
});

const chatRef = collection(db,"chatGlobal");
const q = query(chatRef, orderBy("data","asc"));

onSnapshot(q, snapshot=>{
  const chatBox = document.getElementById("chatBox");
  chatBox.innerHTML = "";

  snapshot.forEach(doc=>{
    const msg = doc.data();

    const div = document.createElement("div");
    div.classList.add("mensagem");

    if(usuarioAtual && msg.uid === usuarioAtual.uid){
      div.classList.add("minha");
    } else {
      div.classList.add("outro");
    }

    div.innerHTML = `
      <strong>${msg.nome}</strong><br>
      ${msg.texto}<br>
      <small>${new Date(msg.data.seconds*1000).toLocaleTimeString()}</small>
    `;

    chatBox.appendChild(div);
  });

  chatBox.scrollTop = chatBox.scrollHeight;
});

window.enviar = async function(){

  const texto = document.getElementById("mensagem").value.trim();

  if(!texto) return;

  await addDoc(collection(db,"chatGlobal"),{
    texto:texto,
    nome:usuarioAtual.email,
    uid:usuarioAtual.uid,
    data:new Date()
  });

  document.getElementById("mensagem").value="";
};

</script>

</body>
</html>
