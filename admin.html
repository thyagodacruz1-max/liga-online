<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin - Liga Online</title>

<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  text-align:center;
}

h1{ color:#00f2ff; }

.section{ margin:40px 0; }

.card{
  background:#1c1c1c;
  padding:20px;
  margin:20px auto;
  width:350px;
  border-radius:12px;
}

button{
  padding:8px 12px;
  margin:5px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.remover{ background:#aa0000; color:white; }

.stat{
  background:#1c1c1c;
  margin:10px;
  padding:20px;
  width:200px;
  border-radius:10px;
  display:inline-block;
}

input,select{
  padding:6px;
  margin:5px;
  border-radius:6px;
  border:none;
}
</style>
</head>

<body>

<h1>âš™ï¸ Painel Admin - Liga Online</h1>

<!-- DASHBOARD -->
<div class="section">
  <h2>ğŸ“Š Dashboard</h2>
  <div class="stat">ğŸ‘¥ Jogadores<br><strong id="totalJogadores">0</strong></div>
  <div class="stat">ğŸ’° Arrecadado<br><strong id="totalArrecadado">R$ 0</strong></div>
  <div class="stat">ğŸª™ SnSCoin Total<br><strong id="totalMoedas">0</strong></div>
</div>

<!-- PREMIAÃ‡ÃƒO -->
<div class="section">
  <h2>ğŸ† PremiaÃ§Ã£o da Temporada</h2>
  <button onclick="premiarTemporada()">Premiar Top 3</button>
</div>

<!-- ADMIN PRODUTOS -->
<div class="section">
  <h2>ğŸ› ï¸ Gerenciar Produtos (Admin)</h2>

  <input type="text" id="novoProdutoNome" placeholder="Nome do produto">
  <input type="number" id="novoProdutoPreco" placeholder="PreÃ§o em SnSCoin">
  <button onclick="adicionarProduto()">Adicionar Produto</button>

  <div id="listaProdutosAdmin"></div>
</div>

<!-- LOJA -->
<div class="section">
  <h2>ğŸ›’ Loja - SnSCoin</h2>

  <select id="jogadorLoja"></select>
  <div id="saldoLoja"></div>
  <div id="itensLoja"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc,
  addDoc,
  deleteDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_AUTH",
  projectId: "SEU_PROJECT_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let jogadores = [];
let produtos = [];

/* ================= JOGADORES ================= */

onSnapshot(collection(db,"jogadores"), snapshot=>{

  jogadores = [];
  let total = 0;
  let dinheiro = 0;
  let moedas = 0;

  snapshot.forEach(docSnap=>{
    const j = docSnap.data();
    total++;
    dinheiro += j.valorPago || 0;
    moedas += j.moedas || 0;
    jogadores.push({ id: docSnap.id, ...j });
  });

  document.getElementById("totalJogadores").innerText = total;
  document.getElementById("totalArrecadado").innerText = "R$ "+dinheiro.toFixed(2);
  document.getElementById("totalMoedas").innerText = moedas;

  atualizarSelectLoja();
});

/* ================= PRODUTOS ================= */

onSnapshot(collection(db,"produtos"), snapshot=>{

  produtos = [];
  let htmlAdmin = "";
  let htmlLoja = "";

  snapshot.forEach(docSnap=>{
    const p = docSnap.data();
    produtos.push({ id: docSnap.id, ...p });

    htmlAdmin += `
      <div class="card">
        ${p.nome} - ğŸª™ ${p.preco} SnSCoin
        <button class="remover"
        onclick="removerProduto('${docSnap.id}')">
        Remover</button>
      </div>
    `;

    htmlLoja += `
      <div class="card">
        ${p.nome}<br>
        PreÃ§o: ğŸª™ ${p.preco} SnSCoin<br>
        <button onclick="comprar('${p.id}',${p.preco},'${p.nome}')">
        Comprar</button>
      </div>
    `;
  });

  document.getElementById("listaProdutosAdmin").innerHTML = htmlAdmin;
  document.getElementById("itensLoja").innerHTML = htmlLoja;
});

/* ================= PREMIAÃ‡ÃƒO ================= */

window.premiarTemporada = async function(){

  if(jogadores.length < 3){
    alert("Precisa de pelo menos 3 jogadores.");
    return;
  }

  jogadores.sort((a,b)=>{
    if((b.pontos || 0) !== (a.pontos || 0))
      return (b.pontos || 0) - (a.pontos || 0);
    return (b.elo || 1000) - (a.elo || 1000);
  });

  const premios = [100, 50, 25];

  for(let i=0;i<3;i++){
    const jogador = jogadores[i];
    const novoSaldo = (jogador.moedas || 0) + premios[i];

    await updateDoc(doc(db,"jogadores",jogador.id),{
      moedas: novoSaldo
    });
  }

  alert("ğŸ† PremiaÃ§Ã£o aplicada com sucesso!");
};

/* ================= ADMIN PRODUTOS ================= */

window.adicionarProduto = async function(){

  const nome = document.getElementById("novoProdutoNome").value.trim();
  const preco = parseInt(document.getElementById("novoProdutoPreco").value);

  if(!nome || isNaN(preco) || preco <= 0){
    alert("Preencha corretamente.");
    return;
  }

  await addDoc(collection(db,"produtos"),{ nome, preco });

  document.getElementById("novoProdutoNome").value="";
  document.getElementById("novoProdutoPreco").value="";
};

window.removerProduto = async function(id){
  await deleteDoc(doc(db,"produtos",id));
};

/* ================= LOJA ================= */

function atualizarSelectLoja(){

  const select = document.getElementById("jogadorLoja");
  select.innerHTML="";

  jogadores.forEach(j=>{
    select.innerHTML += `<option value="${j.id}">${j.nome}</option>`;
  });

  atualizarSaldo();
}

document.getElementById("jogadorLoja")
.addEventListener("change", atualizarSaldo);

function atualizarSaldo(){

  const id = document.getElementById("jogadorLoja").value;
  const jogador = jogadores.find(j=>j.id === id);
  if(!jogador) return;

  document.getElementById("saldoLoja").innerHTML =
    `<h3>ğŸª™ Saldo: ${jogador.moedas || 0} SnSCoin</h3>`;
}

window.comprar = async function(produtoId, preco, nomeProduto){

  const id = document.getElementById("jogadorLoja").value;
  const jogador = jogadores.find(j=>j.id === id);
  if(!jogador) return;

  if((jogador.moedas || 0) < preco){
    alert("SnSCoin insuficiente.");
    return;
  }

  let inventario = jogador.inventario ? [...jogador.inventario] : [];

  // ğŸ”’ Produto Ãºnico
  if(inventario.includes(nomeProduto)){
    alert("Produto jÃ¡ comprado.");
    return;
  }

  const novoSaldo = (jogador.moedas || 0) - preco;
  inventario.push(nomeProduto);

  await updateDoc(doc(db,"jogadores",id),{
    moedas: novoSaldo,
    inventario
  });

  alert("Compra realizada!");
};

</script>

</body>
</html>
