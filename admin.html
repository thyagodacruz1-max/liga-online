<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin - Liga Online</title>

<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  text-align:center;
}

h1{ color:#00f2ff; }

.section{ margin:40px 0; }

.card{
  background:#1c1c1c;
  padding:20px;
  margin:20px auto;
  width:350px;
  border-radius:12px;
  transition:0.2s;
}

.card:hover{
  transform:scale(1.02);
}

button{
  padding:8px 12px;
  margin:5px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.confirmar{ background:#00ff88; }
.bloquear{ background:#ff4444; color:white; }
.comprar{ background:#ffaa00; }

.stat{
  background:#1c1c1c;
  margin:10px;
  padding:20px;
  width:200px;
  border-radius:10px;
  display:inline-block;
}

select{
  padding:6px;
  margin:5px;
  border-radius:6px;
  border:none;
}
</style>
</head>

<body>

<h1>âš™ï¸ Painel Admin - Liga Online</h1>

<!-- DASHBOARD -->
<div class="section">
  <h2>ğŸ“Š Dashboard</h2>
  <div class="stat">ğŸ‘¥ Jogadores<br><strong id="totalJogadores">0</strong></div>
  <div class="stat">ğŸ’° Arrecadado<br><strong id="totalArrecadado">R$ 0</strong></div>
  <div class="stat">ğŸª™ Total Moedas<br><strong id="totalMoedas">0</strong></div>
</div>

<!-- PAGAMENTOS -->
<div class="section">
  <h2>ğŸ’³ Pagamentos</h2>
  <div id="listaJogadores"></div>
</div>

<!-- LOJA -->
<div class="section">
  <h2>ğŸ›’ Loja da Liga</h2>

  <select id="jogadorLoja"></select>
  <div id="saldoLoja"></div>
  <div id="inventarioLoja"></div>
  <div id="itensLoja"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgLb8XfVgjmOdyMWxdWKVOygMivU6TRM0",
  authDomain: "liga-online-8f74d.firebaseapp.com",
  projectId: "liga-online-8f74d",
  appId: "1:815073531863:web:38dfaa7114fcda1b001d92"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let jogadores = [];

// ================= ATUALIZAÃ‡ÃƒO EM TEMPO REAL =================
onSnapshot(collection(db,"jogadores"), (snapshot)=>{

  let total = 0;
  let dinheiro = 0;
  let moedas = 0;

  jogadores = [];
  let html = "";

  snapshot.forEach(docSnap=>{
    const j = docSnap.data();

    total++;
    dinheiro += j.valorPago || 0;
    moedas += j.moedas || 0;

    jogadores.push({ id: docSnap.id, ...j });

    html += `
      <div class="card">
        <strong>${j.nome}</strong><br>
        Pago: ${j.pago ? "âœ…" : "ğŸš«"}<br>
        Valor: R$ ${j.valorPago || 0}<br>
        ğŸª™ Moedas: ${j.moedas || 0}<br>
        ğŸ§° Itens: ${(j.inventario || []).join(", ") || "Nenhum"}<br>
        <button class="confirmar" onclick="confirmarPagamento('${docSnap.id}')">Confirmar</button>
        <button class="bloquear" onclick="bloquearPagamento('${docSnap.id}')">Bloquear</button>
      </div>
    `;
  });

  document.getElementById("totalJogadores").innerText = total;
  document.getElementById("totalArrecadado").innerText = "R$ " + dinheiro.toFixed(2);
  document.getElementById("totalMoedas").innerText = moedas;
  document.getElementById("listaJogadores").innerHTML = html;

  atualizarSelectLoja();
});

// ================= PAGAMENTOS =================
window.confirmarPagamento = async function(id){
  const valor = prompt("Digite o valor pago:");
  if(!valor) return;

  await updateDoc(doc(db,"jogadores",id),{
    pago: true,
    valorPago: parseFloat(valor)
  });
};

window.bloquearPagamento = async function(id){
  await updateDoc(doc(db,"jogadores",id),{
    pago: false,
    valorPago: 0
  });
};

// ================= LOJA =================

const itens = [
  { nome:"ğŸ– Badge Ouro", preco:50 },
  { nome:"ğŸ”¥ Boost ELO +20", preco:100 },
  { nome:"ğŸ‘‘ TÃ­tulo Especial", preco:150 }
];

function atualizarSelectLoja(){
  const select = document.getElementById("jogadorLoja");

  const jogadorAtual = select.value;

  select.innerHTML = "";
  jogadores.forEach(j=>{
    select.innerHTML += `<option value="${j.id}">${j.nome}</option>`;
  });

  if(jogadorAtual) select.value = jogadorAtual;

  atualizarLoja();
}

document.getElementById("jogadorLoja")
.addEventListener("change", atualizarLoja);

function atualizarLoja(){

  const id = document.getElementById("jogadorLoja").value;
  const jogador = jogadores.find(j=>j.id === id);
  if(!jogador) return;

  document.getElementById("saldoLoja").innerHTML =
    `<h3>ğŸª™ Saldo: ${jogador.moedas || 0}</h3>`;

  document.getElementById("inventarioLoja").innerHTML =
    `<p>ğŸ§° InventÃ¡rio: ${(jogador.inventario || []).join(", ") || "Nenhum"}</p>`;

  let html = "";

  itens.forEach(item=>{
    html += `
      <div class="card">
        ${item.nome}<br>
        PreÃ§o: ğŸª™ ${item.preco}<br>
        <button class="comprar" onclick="comprar('${item.nome}',${item.preco})">
          Comprar
        </button>
      </div>
    `;
  });

  document.getElementById("itensLoja").innerHTML = html;
}

window.comprar = async function(nome, preco){

  const id = document.getElementById("jogadorLoja").value;
  const jogador = jogadores.find(j=>j.id === id);

  if(!jogador){
    alert("Selecione um jogador.");
    return;
  }

  if((jogador.moedas || 0) < preco){
    alert("ğŸš« Moedas insuficientes!");
    return;
  }

  let inventario = jogador.inventario || [];

  if(nome === "ğŸ– Badge Ouro" && inventario.includes(nome)){
    alert("Este jogador jÃ¡ possui essa Badge!");
    return;
  }

  let novoElo = jogador.elo || 1000;

  if(nome === "ğŸ”¥ Boost ELO +20"){
    novoElo += 20;
  }

  const novoSaldo = (jogador.moedas || 0) - preco;
  inventario.push(nome);

  await updateDoc(doc(db,"jogadores",id),{
    moedas: novoSaldo,
    inventario: inventario,
    elo: novoElo
  });

  alert("âœ… Compra realizada!");
};

</script>

</body>
</html>

