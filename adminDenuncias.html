<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Painel de ModeraÃ§Ã£o - Liga Online</title>

<style>
body{
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  margin:0;
  padding:20px;
}

header{
  background:#000;
  padding:15px;
  text-align:center;
  border-bottom:2px solid #ff4444;
}

.menu{
  text-align:center;
  margin:15px 0;
}

.menu button{
  padding:8px 12px;
  margin:5px;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  background:#00f2ff;
}

h1{
  text-align:center;
  color:#ff4444;
}

.card{
  background:#1c1c1c;
  padding:15px;
  margin:15px auto;
  border-radius:8px;
  max-width:700px;
}

.status{
  font-weight:bold;
}

.pendente{ color:orange; }
.resolvido{ color:lightgreen; }

button{
  padding:6px 10px;
  margin:5px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

.ban{ background:#aa0000; color:white; }
.mute{ background:#ff9900; color:black; }
.remover{ background:#666; color:white; }
.resolver{ background:#00cc66; color:black; }

</style>
</head>
<body>

<header>
  ğŸš¨ Painel de ModeraÃ§Ã£o
</header>

<div class="menu">
  <a href="admin.html"><button>âš™ï¸ Admin</button></a>
  <a href="index.html"><button>ğŸ† ClassificaÃ§Ã£o</button></a>
  <button onclick="logout()">ğŸšª Sair</button>
</div>

<h1>DenÃºncias Registradas</h1>

<div id="listaDenuncias"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc,
  deleteDoc,
  getDoc,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import {
  getAuth,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgLb8XfVgjmOdyMWxdWKVOygMivU6TRM0",
  authDomain: "liga-online-8f74d.firebaseapp.com",
  projectId:"liga-online-8f74d",
  appId: "1:815073531863:web:625fe25cfe74e705001d92",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ğŸ” PROTEGER ROTA + VERIFICAR CARGO
onAuthStateChanged(auth, async user=>{
  if(!user){
    window.location.href="login.html";
    return;
  }

  const cargoDoc = await getDoc(doc(db,"usuarios",user.uid));

  if(!cargoDoc.exists()){
    window.location.href="login.html";
    return;
  }

  const cargo = cargoDoc.data().cargo;

  if(cargo !== "admin" && cargo !== "moderador"){
    alert("Sem permissÃ£o.");
    window.location.href="login.html";
  }
});

// ğŸ”¥ LISTAR DENÃšNCIAS
const denunciasRef = query(
  collection(db,"denuncias"),
  orderBy("data","desc")
);

onSnapshot(denunciasRef, async snapshot=>{

  const container=document.getElementById("listaDenuncias");
  container.innerHTML="";

  for(const docSnap of snapshot.docs){

    const denuncia=docSnap.data();

    const mensagemDoc=await getDoc(doc(db,"chatGlobal",denuncia.mensagemId));
    const textoMensagem=mensagemDoc.exists()
      ? mensagemDoc.data().texto
      : "Mensagem jÃ¡ removida";

    const classeStatus = denuncia.status === "resolvido"
      ? "resolvido"
      : "pendente";

    container.innerHTML+=`
      <div class="card">
        <strong>Mensagem:</strong> ${textoMensagem}<br>
        <strong>Denunciado UID:</strong> ${denuncia.denunciado}<br>
        <strong>Status:</strong>
        <span class="status ${classeStatus}">
          ${denuncia.status || "pendente"}
        </span><br>

        <button class="remover"
          onclick="removerMensagem('${denuncia.mensagemId}')">
          ğŸ—‘ Remover Mensagem
        </button>

        <button class="mute"
          onclick="mutarJogador('${denuncia.denunciado}')">
          ğŸ”‡ Mutar 24h
        </button>

        <button class="ban"
          onclick="banirJogador('${denuncia.denunciado}')">
          â›” Banir
        </button>

        <button class="resolver"
          onclick="resolver('${docSnap.id}')">
          âœ… Marcar Resolvido
        </button>
      </div>
    `;
  }

});

// ğŸ—‘ REMOVER MENSAGEM
window.removerMensagem = async function(mensagemId){
  await deleteDoc(doc(db,"chatGlobal",mensagemId));
  alert("Mensagem removida.");
};

// ğŸ”‡ MUTE 24H
window.mutarJogador = async function(uid){

  const expira = new Date();
  expira.setHours(expira.getHours()+24);

  await updateDoc(doc(db,"jogadores",uid),{
    muteAte: expira
  });

  alert("Jogador mutado por 24 horas.");
};

// â›” BANIR
window.banirJogador = async function(uid){

  await updateDoc(doc(db,"jogadores",uid),{
    banido:true
  });

  alert("Jogador banido.");
};

// âœ… RESOLVER
window.resolver = async function(id){
  await updateDoc(doc(db,"denuncias",id),{
    status:"resolvido"
  });
  alert("DenÃºncia marcada como resolvida.");
};

// ğŸšª LOGOUT
window.logout = function(){
  signOut(auth);
  window.location.href="login.html";
};

</script>

</body>
</html>
