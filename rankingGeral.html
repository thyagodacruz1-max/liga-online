<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ranking Geral - Liga Online</title>

<style>
body{
  margin:0;
  background:#0f0f0f;
  color:white;
  font-family:Arial;
  text-align:center;
  transition:0.3s;
}

body.light{
  background:#f4f4f4;
  color:#111;
}

h1{
  color:#00f2ff;
  margin-top:20px;
}

.controls{
  margin:15px;
}

input, select, button{
  padding:8px;
  margin:5px;
  border-radius:6px;
  border:none;
}

button{
  cursor:pointer;
  font-weight:bold;
}

table{
  width:95%;
  margin:20px auto;
  border-collapse:collapse;
  background:#1c1c1c;
  border-radius:10px;
  overflow:hidden;
}

body.light table{
  background:white;
}

th,td{
  padding:12px;
  border-bottom:1px solid #333;
}

body.light th, 
body.light td{
  border-bottom:1px solid #ddd;
}

th{
  background:#111;
  color:#00f2ff;
}

body.light th{
  background:#ddd;
  color:#111;
}

tr:hover{
  background:#222;
}

body.light tr:hover{
  background:#eee;
}

.lider{
  background:#ffd70033;
  font-weight:bold;
  animation: brilho 1.5s infinite alternate;
}

@keyframes brilho{
  from{box-shadow:0 0 5px #ffd700;}
  to{box-shadow:0 0 25px #ffd700;}
}

.score{
  color:#00f2ff;
  font-weight:bold;
}

.lenda{
  color:#ff4444;
  font-weight:bold;
}

.sem-dados{
  margin-top:40px;
  font-size:18px;
  color:#888;
}
</style>
</head>

<body>

<h1>üëë Ranking Geral da Liga</h1>

<div class="controls">
  <input type="text" id="busca" placeholder="Buscar jogador...">
  <select id="filtroSerie">
    <option value="GERAL">Geral</option>
    <option value="A">S√©rie A</option>
    <option value="B">S√©rie B</option>
    <option value="C">S√©rie C</option>
  </select>
  <button onclick="alternarTema()">üåô/‚òÄÔ∏è Tema</button>
</div>

<div id="ranking"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgLb8XfVgjmOdyMWxdWKVOygMivU6TRM0",
  authDomain: "liga-online-8f74d.firebaseapp.com",
  projectId: "liga-online-8f74d",
  appId: "1:815073531863:web:38dfaa7114fcda1b001d92"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const rankingDiv = document.getElementById("ranking");
const filtroSerie = document.getElementById("filtroSerie");
const buscaInput = document.getElementById("busca");

let todosJogadores = [];

if(localStorage.getItem("tema") === "light"){
  document.body.classList.add("light");
}

onSnapshot(collection(db,"jogadores"), (snapshot)=>{

  todosJogadores = [];

  snapshot.forEach(doc=>{
    const j = doc.data();

    const score = 
      (j.pontos || 0) +
      ((j.titulos || 0) * 10) +
      ((j.vitorias || 0) * 2);

    todosJogadores.push({
      nome: j.nome,
      serie: j.serie,
      score: score,
      pontos: j.pontos || 0,
      titulos: j.titulos || 0,
      vitorias: j.vitorias || 0
    });
  });

  renderRanking();
});

filtroSerie.addEventListener("change", renderRanking);
buscaInput.addEventListener("input", renderRanking);

function renderRanking(){

  let jogadores = [...todosJogadores];

  if(filtroSerie.value !== "GERAL"){
    jogadores = jogadores.filter(j => j.serie === filtroSerie.value);
  }

  if(buscaInput.value){
    jogadores = jogadores.filter(j =>
      j.nome.toLowerCase().includes(buscaInput.value.toLowerCase())
    );
  }

  jogadores.sort((a,b)=>{
    if(b.score !== a.score) return b.score - a.score;
    if(b.titulos !== a.titulos) return b.titulos - a.titulos;
    return b.pontos - a.pontos;
  });

  if(jogadores.length === 0){
    rankingDiv.innerHTML = `<div class="sem-dados">Nenhum jogador encontrado.</div>`;
    return;
  }

  let html = `
  <table>
    <tr>
      <th>#</th>
      <th>Jogador</th>
      <th>S√©rie</th>
      <th>Pontos</th>
      <th>Vit√≥rias</th>
      <th>T√≠tulos</th>
      <th>Score</th>
    </tr>
  `;

  jogadores.forEach((j,index)=>{

    let medalha = "";
    let classe = "";

    if(index === 0){
      medalha = "ü•á";
      classe = "lider";
    } else if(index === 1){
      medalha = "ü•à";
    } else if(index === 2){
      medalha = "ü•â";
    }

    let badgeLenda = j.titulos >= 3 ? `<span class="lenda"> üëë Lenda</span>` : "";

    html += `
      <tr class="${classe}">
        <td>${medalha} ${index+1}</td>
        <td>${j.nome}${badgeLenda}</td>
        <td>${j.serie}</td>
        <td>${j.pontos}</td>
        <td>${j.vitorias}</td>
        <td>üèÜ ${j.titulos}</td>
        <td class="score">${j.score}</td>
      </tr>
    `;
  });

  html += "</table>";
  rankingDiv.innerHTML = html;
}

window.alternarTema = function(){
  document.body.classList.toggle("light");
  localStorage.setItem(
    "tema",
    document.body.classList.contains("light") ? "light" : "dark"
  );
};

</script>

</body>
</html>

